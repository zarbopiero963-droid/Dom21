name: üåç Webshare Network & Stealth Audit (Ghost Mode)

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  workflow_dispatch: # Permette di avviarlo manualmente dal sito
  schedule:
    # Esegue l'audit in automatico ogni Luned√¨ alle 04:00 AM (UTC)
    - cron: '0 4 * * 1'

jobs:
  stealth-audit:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout del codice repository
      uses: actions/checkout@v4
      
    - name: Setup Python 3.10
      uses: actions/setup-python@v4
      with:
        python-version: "3.10"
        
    - name: Installazione Dipendenze (Playwright & Requests)
      run: |
        python -m pip install --upgrade pip
        # üõ°Ô∏è Aggiunto 'requests' per interrogare le API di Webshare
        pip install playwright pytest requests
        
    - name: Installazione Motore Chromium C++
      run: python -m playwright install chromium --with-deps
      
    - name: üåç Esecuzione Webshare API & Bet365 Network Test
      env:
        # üõ°Ô∏è Inietta il token API dai segreti di GitHub
        WEBSHARE_TOKEN: ${{ secrets.WEBSHARE_TOKEN }}
      run: |
        # xvfb-run emula un display X11 virtuale (fondamentale per ingannare
        # i test anti-bot che cercano la presenza di uno schermo fisico)
        # Il flag -u forza i log in tempo reale su GitHub!
        
        # Lancia il nuovo test di rete isolato
        xvfb-run -a python -u tests/tests/network/test_webshare_bet365.py

    # (Opzionale) Se hai ancora il vecchio test ANTI_DETECT_AUDIT.py e vuoi farlo girare senza proxy, 
    # puoi decommentare queste righe:
    # - name: üïµÔ∏è‚Äç‚ôÇÔ∏è Esecuzione Ultimate Anti-Detect Audit Logico
    #   run: |
    #     xvfb-run -a python -u tests/tests/system_integrity/ANTI_DETECT_AUDIT.py
